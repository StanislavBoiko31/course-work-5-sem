# Варіанти передачі результатів незареєстрованим клієнтам (гостям)

## Поточна ситуація
- Гості залишають email при бронюванні (`guest_email`)
- Результати зберігаються в `booking.result_photos` та `booking.result_videos`
- Зареєстровані користувачі можуть переглядати результати в особистому кабінеті

---

## Варіант 1: Email з посиланням на завантаження ⭐ (Рекомендовано)

### Опис:
Автоматична відправка email з посиланням на сторінку завантаження результатів.

### Переваги:
- ✅ Просто реалізувати
- ✅ Зручно для клієнта
- ✅ Не потребує додаткових налаштувань
- ✅ Можна додати персональне повідомлення

### Недоліки:
- ⚠️ Потребує налаштування email сервера (SMTP)
- ⚠️ Посилання може бути небезпечним (якщо не додати токен)

### Реалізація:
1. Генерація унікального токену для кожного замовлення
2. Створення публічної сторінки `/results/{booking_id}/{token}/`
3. Відправка email з посиланням при встановленні статусу "Завершено"
4. Перевірка токену перед показом результатів

### Структура:
```
/models.py:
  - Booking.access_token (CharField, unique)
  - Booking.token_expires_at (DateTimeField)

/views.py:
  - GuestResultsView (публічний доступ з токеном)
  - send_results_email() (відправка email)

/urls.py:
  - path('results/<int:booking_id>/<str:token>/', GuestResultsView)

/templates/email/results_ready.html:
  - HTML шаблон листа
```

---

## Варіант 2: Публічна сторінка з пошуком за email + ID замовлення

### Опис:
Клієнт вводить email та ID замовлення на публічній сторінці для доступу до результатів.

### Переваги:
- ✅ Не потребує email сервера
- ✅ Просто реалізувати
- ✅ Клієнт сам контролює доступ

### Недоліки:
- ⚠️ Менш зручно (потрібно пам'ятати ID)
- ⚠️ Менша безпека (якщо хтось знає email + ID)
- ⚠️ Клієнт може забути ID замовлення

### Реалізація:
1. Створення публічної сторінки `/guest-results/`
2. Форма з полями: Email, ID замовлення
3. Перевірка відповідності email та ID
4. Показ результатів після успішної перевірки

### Структура:
```
/views.py:
  - GuestResultsSearchView (GET - форма, POST - перевірка)

/urls.py:
  - path('guest-results/', GuestResultsSearchView)

/frontend:
  - GuestResultsPage.js (форма пошуку)
```

---

## Варіант 3: Email з прямими посиланнями на файли (архів)

### Опис:
Відправка email з прямими посиланнями на всі файли або з архівом.

### Переваги:
- ✅ Клієнт отримує все одразу
- ✅ Не потребує додаткових сторінок

### Недоліки:
- ⚠️ Email може бути занадто великим
- ⚠️ Посилання можуть стати неактуальними
- ⚠️ Менш зручно для великої кількості файлів

### Реалізація:
1. Створення ZIP архіву з усіма файлами
2. Збереження архіву тимчасово
3. Відправка email з посиланням на архів
4. Автоматичне видалення архіву через 7 днів

---

## Варіант 4: SMS з посиланням (якщо є номер телефону)

### Опис:
Відправка SMS з посиланням на результати (якщо зберігається номер телефону).

### Переваги:
- ✅ Швидко доходить
- ✅ Зручно для клієнта

### Недоліки:
- ⚠️ Потребує SMS сервіс (платний)
- ⚠️ Потрібно зберігати номер телефону
- ⚠️ Додаткові витрати

---

## Варіант 5: Гібридний підхід (Email + Публічна сторінка) ⭐⭐ (Найкраще)

### Опис:
Комбінація варіантів 1 та 2:
- Автоматична відправка email з посиланням
- Можливість самостійного пошуку за email + ID

### Переваги:
- ✅ Максимальна зручність
- ✅ Резервний варіант (якщо email не дійшов)
- ✅ Гнучкість для клієнта

### Недоліки:
- ⚠️ Потребує реалізації обох варіантів
- ⚠️ Потребує email сервер

---

## Рекомендація

**Для початку:** Варіант 1 (Email з токеном) - найпростіший і найбезпечніший.

**Для production:** Варіант 5 (Гібридний) - максимальна зручність та надійність.

---

## Технічні деталі для реалізації

### Email налаштування (Django):
```python
# settings.py
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = 'your-email@gmail.com'
EMAIL_HOST_PASSWORD = 'your-app-password'
DEFAULT_FROM_EMAIL = 'your-email@gmail.com'
```

### Генерація токену:
```python
import secrets
token = secrets.token_urlsafe(32)  # Безпечний випадковий токен
```

### Створення моделі:
```python
# models.py
access_token = models.CharField(max_length=64, unique=True, null=True, blank=True)
token_expires_at = models.DateTimeField(null=True, blank=True)
```

---

## Питання для уточнення:

1. Чи є налаштований email сервер?
2. Чи потрібна висока безпека (токени) чи достатньо простого пошуку?
3. Чи потрібна можливість скачування всіх файлів одним архівом?
4. Як довго результати мають бути доступні?

